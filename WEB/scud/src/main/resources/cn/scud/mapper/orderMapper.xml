<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.scud.main.order.dao.OrderDao">
    <cache />

    <resultMap id="orderMap" type="cn.scud.main.order.model.UserOrder">
        <id property="orderId" column="order_id"/>
        <result property="orderUserToken" column="order_usertoken"/>
        <result property="orderComplteFlag" column="order_complteflag"/>
        <result property="orderToken" column="order_token"/>
        <result property="orderTitle" column="order_title"/>
        <result property="orderContent" column="order_content"/>
        <result property="orderStartTime" column="order_starttime"/>
        <result property="orderLimitTime" column="order_limittime"/>
        <result property="orderServiceAddress" column="order_serviceaddress"/>
        <result property="orderCallScope" column="order_callscope"/>
        <result property="orderMonty" column="order_money"/>
    </resultMap>

    <!--保存订单-->
    <insert id="saveOrder" parameterType="UserOrder">
        INSERT INTO userorder (order_usertoken,order_token,order_title,order_content,order_starttime,order_limittime,order_serviceaddress,order_callscope,order_money)
        VALUES (#{orderUserToken},#{orderToken},#{orderTitle},#{orderContent},#{orderStartTime},#{orderLimitTime},#{orderServiceAddress},#{orderCallScope},#{orderMoney})
    </insert>

    <!--根据userToken，获取orderlists-->
    <select id="listOrdersByToken" resultMap="orderMap" parameterType="String" >
        SELECT * from userorder where order_usertoken = #{userToken}
    </select>

    <!--根据orderToken，获取order-->
    <select id="getOrderByToken" resultMap="orderMap" parameterType="String">
        SELECT * FROM userorder where order_token = ${orderToken}
    </select>

    <!--根据orderToken 标记 order 完成-->
    <update id="setOrderComplete" parameterType="String">
        UPDATE userorder SET orderComplteFlag = true where orderUserToken =${orderToken}
    </update>

    <!--根据userTokens 查询 orders-->
    <select id="getOrdersByUsTokens" resultMap="orderMap">
        SELECT * from userorder where order_usertoken in
        <foreach collection="list" item="userToken" index="index"
                 open="(" close=")" separator=",">
            #{userToken}
        </foreach>
    </select>
</mapper>